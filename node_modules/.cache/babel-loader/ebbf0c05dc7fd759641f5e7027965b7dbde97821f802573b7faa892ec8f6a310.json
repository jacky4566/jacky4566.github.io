{"ast":null,"code":"import { PLACEMENT_TYPE_HERO } from \"../helpers/consts\";\nimport { placementFactory } from \"./PlacementFactory\";\nimport { GameLoop } from \"./GameLoop\";\nimport { DirectionControls } from \"./DirectionControls\";\nimport LevelsMap from \"../levels/LevelsMap\";\nexport class LevelState {\n  constructor(levelId, onEmit) {\n    this.id = levelId;\n    this.onEmit = onEmit;\n    this.directionControls = new DirectionControls();\n\n    //Start the level!\n    this.start();\n  }\n  start() {\n    this.isCompleted = false;\n    const levelData = LevelsMap[this.id];\n    this.theme = levelData.theme;\n    this.tilesWidth = levelData.tilesWidth;\n    this.tilesHeight = levelData.tilesHeight;\n    this.placements = levelData.placements.map(config => {\n      return placementFactory.createPlacement(config, this);\n    });\n\n    // Cache a reference to the hero\n    this.heroRef = this.placements.find(p => p.type === PLACEMENT_TYPE_HERO);\n    this.startGameLoop();\n  }\n  startGameLoop() {\n    var _this$gameLoop;\n    (_this$gameLoop = this.gameLoop) === null || _this$gameLoop === void 0 ? void 0 : _this$gameLoop.stop();\n    this.gameLoop = new GameLoop(() => {\n      this.tick();\n    });\n  }\n  addPlacement(config) {\n    this.placements.push(placementFactory.createPlacement(config, this));\n  }\n  deletePlacement(placementToRemove) {\n    this.placements = this.placements.filter(p => {\n      return p.id !== placementToRemove.id;\n    });\n  }\n  tick() {\n    // Check for movement here...\n    if (this.directionControls.direction) {\n      this.heroRef.controllerMoveRequested(this.directionControls.direction);\n    }\n\n    // Call 'tick' on any Placement that wants to update\n    this.placements.forEach(placement => {\n      placement.tick();\n    });\n\n    //Emit any changes to React\n    this.onEmit(this.getState());\n  }\n  isPositionOutOfBounds(x, y) {\n    return x === 0 || y === 0 || x >= this.tilesWidth + 1 || y >= this.tilesHeight + 1;\n  }\n  completeLevel() {\n    this.isCompleted = true;\n    this.gameLoop.stop();\n  }\n  getState() {\n    return {\n      theme: this.theme,\n      tilesWidth: this.tilesWidth,\n      tilesHeight: this.tilesHeight,\n      placements: this.placements,\n      isCompleted: this.isCompleted\n    };\n  }\n  destroy() {\n    // Tear down the level.\n    this.gameLoop.stop();\n    this.directionControls.unbind();\n  }\n}","map":{"version":3,"names":["PLACEMENT_TYPE_HERO","placementFactory","GameLoop","DirectionControls","LevelsMap","LevelState","constructor","levelId","onEmit","id","directionControls","start","isCompleted","levelData","theme","tilesWidth","tilesHeight","placements","map","config","createPlacement","heroRef","find","p","type","startGameLoop","_this$gameLoop","gameLoop","stop","tick","addPlacement","push","deletePlacement","placementToRemove","filter","direction","controllerMoveRequested","forEach","placement","getState","isPositionOutOfBounds","x","y","completeLevel","destroy","unbind"],"sources":["C:/GitHub/AthabascaCPSCI/COMP 486/Mineral Mayhem/src/classes/LevelState.js"],"sourcesContent":["import { PLACEMENT_TYPE_HERO } from \"../helpers/consts\";\r\nimport { placementFactory } from \"./PlacementFactory\";\r\nimport { GameLoop } from \"./GameLoop\";\r\nimport { DirectionControls } from \"./DirectionControls\";\r\nimport LevelsMap from \"../levels/LevelsMap\";\r\n\r\nexport class LevelState {\r\n  constructor(levelId, onEmit) {\r\n    this.id = levelId;\r\n    this.onEmit = onEmit;\r\n    this.directionControls = new DirectionControls();\r\n\r\n    //Start the level!\r\n    this.start();\r\n  }\r\n\r\n  start() {\r\n    this.isCompleted = false;\r\n    const levelData = LevelsMap[this.id];\r\n\r\n    this.theme = levelData.theme;\r\n    this.tilesWidth = levelData.tilesWidth;\r\n    this.tilesHeight = levelData.tilesHeight;\r\n    this.placements = levelData.placements.map((config) => {\r\n      return placementFactory.createPlacement(config, this);\r\n    });\r\n\r\n    // Cache a reference to the hero\r\n    this.heroRef = this.placements.find((p) => p.type === PLACEMENT_TYPE_HERO);\r\n\r\n\r\n    this.startGameLoop();\r\n  }\r\n\r\n  startGameLoop() {\r\n    this.gameLoop?.stop();\r\n    this.gameLoop = new GameLoop(() => {\r\n      this.tick();\r\n    });\r\n  }\r\n\r\n  addPlacement(config) {\r\n    this.placements.push(placementFactory.createPlacement(config, this));\r\n  }\r\n\r\n  deletePlacement(placementToRemove) {\r\n    this.placements = this.placements.filter((p) => {\r\n      return p.id !== placementToRemove.id;\r\n    });\r\n  }\r\n\r\n  tick() {\r\n    // Check for movement here...\r\n    if (this.directionControls.direction) {\r\n      this.heroRef.controllerMoveRequested(this.directionControls.direction);\r\n    }\r\n\r\n    // Call 'tick' on any Placement that wants to update\r\n    this.placements.forEach((placement) => {\r\n      placement.tick();\r\n    });\r\n\r\n    //Emit any changes to React\r\n    this.onEmit(this.getState());\r\n  }\r\n\r\n  isPositionOutOfBounds(x, y) {\r\n    return (\r\n      x === 0 ||\r\n      y === 0 ||\r\n      x >= this.tilesWidth + 1 ||\r\n      y >= this.tilesHeight + 1\r\n    );\r\n  }\r\n\r\n  completeLevel() {\r\n    this.isCompleted = true;\r\n    this.gameLoop.stop();\r\n  }\r\n\r\n  getState() {\r\n    return {\r\n      theme: this.theme,\r\n      tilesWidth: this.tilesWidth,\r\n      tilesHeight: this.tilesHeight,\r\n      placements: this.placements,\r\n      isCompleted: this.isCompleted,\r\n    };\r\n  }\r\n\r\n  destroy() {\r\n    // Tear down the level.\r\n    this.gameLoop.stop();\r\n    this.directionControls.unbind();\r\n  }\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}